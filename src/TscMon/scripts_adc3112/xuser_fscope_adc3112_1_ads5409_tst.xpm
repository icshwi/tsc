#*****************************************************************#
#                    XprsMon Script file                          #
#                XUSER FASTSCOPE (2x ADC_3112)                    #
#   Title        : xuser_fscope_adc3112_1_ads5409_tst.xpm         #
#   Description  : Basic verification 2x ADS5409                  #
#   Author       : J. Bovier                                      #
#*****************************************************************#
# Version 0.1 16-01-2015 : Initial version ifC_1410/1211          #
#*****************************************************************#

# Check if FMC1 ADC_3112 is present + Signature OK
cr.ws 1200 31120201 FFFFFFFF                     # Check ADC_3112 SIGN_CSR (Type, Version, Revision)
cr.ws 1204 20000000 FF000000                     # Check ADC_3112 MAIN_CSR (options instantiated)
#
pr.ws 1200 31120000                             # Enable FMC physical interface (out of tri-state)
#
# -- WARNING : ADS5409 SPI Bus is by default with 3-wire SPI mode
#              --> shall be forced to operate with 4-wire SPI interface
#
pr.ws 1204 0                                     # Remove ADC RESET (SPI interface RESET)
pr.ws 1204 100                                   # Activate ADC RESET (SPI interface RESET)
pr.ws 1204 0                                     # Remove ADC RESET (SPI interface RESET)
#
@xuser_fscope_adc3112_1_ads5409_init.xpm
#
@xuser_fscope_adc3112_1_lmkinit_intref.xpm
#

$usleep 2000
$echo *****************************************************************
$echo ADS5409 Channel 01 U737                                     
$echo *****************************************************************
adc3112.1 ads01 read 0                           # ADS5409 Register read
cr.ws 1210 00008000 0000ffff
adc3112.1 ads01 read 1                           # ADS5409 Register read
cr.ws 1210 00008206 0000ffff
adc3112.1 ads01 read 2                           # ADS5409 Register read
cr.ws 1210 00000780 000007ff
adc3112.1 ads01 read 3                           # ADS5409 Register read
cr.ws 1210 00000B18 0000ffff
adc3112.1 ads01 read E                           # ADS5409 Register read
cr.ws 1210 0000AAA8 0000ffff
adc3112.1 ads01 read F                           # ADS5409 Register read
cr.ws 1210 0000A000 0000ffff
adc3112.1 ads01 read 1A                          # ADS5409 Register read
cr.ws 1210 00000b18 0000ffff
adc3112.1 ads01 read 2B                          # ADS5409 Register read Thermal sensor
adc3112.1 ads01 read 2C                          # ADS5409 Register read
cr.ws 1210 00000000 0000ffff
adc3112.1 ads01 read 37                          # ADS5409 Register read
cr.ws 1210 0000d400 0000ffff
adc3112.1 ads01 read 38                          # ADS5409 Register read
cr.ws 1210 0000ffff 0000ffff
adc3112.1 ads01 read 3A                          # ADS5409 Register read
cr.ws 1210 00004a18 0000ffff
#
adc3112.1 ads01 write 66 1234                    # ADS5409 Register write
adc3112.1 ads01 write 67 5678                    # ADS5409 Register write
adc3112.1 ads01 read 66                          # ADS5409 Register read
cr.ws 1210 00001234 0000ffff
adc3112.1 ads01 read 67                          # ADS5409 Register read
cr.ws 1210 00005678 0000ffff
#adc3112.1 ads01 write 66 0                       # ADS5409 Register write
#adc3112.1 ads01 write 67 0                       # ADS5409 Register write
#
$echo *****************************************************************
$echo ADS5409 Channel 23 U740                                     
$echo *****************************************************************
adc3112.1 ads23 read 0                           # ADS5409 Register read
cr.ws 1210 00008000 0000ffff
adc3112.1 ads23 read 1                           # ADS5409 Register read
cr.ws 1210 00008206 0000ffff
adc3112.1 ads23 read 2                           # ADS5409 Register read
cr.ws 1210 00000780 000007ff
adc3112.1 ads23 read 3                           # ADS5409 Register read
cr.ws 1210 00000B18 0000ffff
adc3112.1 ads23 read E                           # ADS5409 Register read
cr.ws 1210 0000AAA8 0000ffff
adc3112.1 ads23 read F                           # ADS5409 Register read
cr.ws 1210 0000A000 0000ffff
adc3112.1 ads23 read 1A                          # ADS5409 Register read
cr.ws 1210 00000b18 0000ffff
adc3112.1 ads23 read 2B                          # ADS5409 Register read Thermal sensor
adc3112.1 ads23 read 2C                          # ADS5409 Register read
cr.ws 1210 00000000 0000ffff
adc3112.1 ads23 read 37                          # ADS5409 Register read
cr.ws 1210 0000d400 0000ffff
adc3112.1 ads23 read 38                          # ADS5409 Register read
cr.ws 1210 0000ffff 0000ffff
adc3112.1 ads23 read 3A                          # ADS5409 Register read
cr.ws 1210 00004a18 0000ffff
#
adc3112.1 ads23 write 66 9abc                    # ADS5409 Register write
adc3112.1 ads23 write 67 def0                    # ADS5409 Register write
adc3112.1 ads23 read 66                          # ADS5409 Register read
cr.ws 1210 00009abc 0000ffff
adc3112.1 ads23 read 67                          # ADS5409 Register read
cr.ws 1210 0000def0 0000ffff
#
adc3112.1 ads01 read 66                          # ADS5409 Register read
cr.ws 1210 00001234 0000ffff
adc3112.1 ads01 read 67                          # ADS5409 Register read
cr.ws 1210 00005678 0000ffff
#
adc3112.1 ads01 write 66 0                       # ADS5409 Register write
adc3112.1 ads01 write 67 0                       # ADS5409 Register write
adc3112.1 ads23 write 66 0                       # ADS5409 Register write
adc3112.1 ads23 write 67 0                       # ADS5409 Register write

$echo *****************************************************************
$echo      ADS5409 temperature                                     
$echo *****************************************************************
#
adc3112.1 tmp102 show
#
adc3112.1 xratrig write 2 20                  # XRA1404 OCR ADC_ENABLE = 0
#adc3112.1 xratrig write 2 60                 # XRA1404 OCR ADC_ENABLE = 1
$echo *****************************************************************
$echo End ADS5409 Internal register RW Basic verification                                       
$echo *****************************************************************
# <EOF>
