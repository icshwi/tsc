#*****************************************************************#
#                    XprsMon Script file                          #
#                XUSER FASTSCOPE (2x ADC_3112)                    #
#   Title        : xuser_fscope_adc3112_1_xra1404_init.xpm        #
#   Description  : XRA1404 initialisation                         #
#   Author       : J. Bovier / J-L Bolli                          #
#*****************************************************************#
# Version 0.1 16-01-2015 : Initial version ifC_1410/1211          #
#*****************************************************************#
#
# Check if FMC1 ADC_3112 is present + Signature OK
cr.ws 1200 31120201 FFFFFFFF                 # Check ADC_3112 SIGN_CSR (Type, Version, Revision)
#
pr.ws 1200 31120000                             # Enable FMC physical interface (out of tri-state)
#
pi.ws 000C C0000000                             # Turn ON FMC Slots !
$usleep 50000
#
# ------------------------------------------------------
# Initialize Front-end INPUT
# ------------------------------------------------------
adc3112.1 xratrig write 6 00                 # XRA1404 GCR Initialisation -> All outputs
adc3112.1 xratrig write 8 B8                 # XRA1404 PUR Initialisation -> Pull-up 3.3V
adc3112.1 xratrig write c 07                 # XRA1404 TSCR Initialisation -> High impedance
adc3112.1 xratrig write 2 20                 # XRA1404 OCR ADC_ENABLE = 0  -> ADS5409 ENABLE = '0'
#
adc3112.1 xra01 write 6 00                   # XRA1404 GCR Initialisation -> All outputs
adc3112.1 xra01 write 8 FF                   # XRA1404 PUR Initialisation -> Pull-up 3.3V
adc3112.1 xra01 write c 00                   # XRA1404 TSCR Initialisation -> All totem-pole   
#
adc3112.1 xra23 write 6 00                   # XRA1404 GCR Initialisation -> All outputs
adc3112.1 xra23 write 8 FF                   # XRA1404 PUR Initialisation -> Pull-up 3.3V
adc3112.1 xra23 write c 00                   # XRA1404 TSCR Initialisation -> All totem-pole
#
#adc3112.1 xratrig write 2 20                # XRA1404 OCR ADC_ENABLE = 0 -> ADC Disabled
adc3112.1 xratrig write 2 60                 # XRA1404 OCR ADC_ENABLE = 1 -> ADC Enabled
#
# ------------------------------------------------------
# Initialize control dual DAC U745
# ------------------------------------------------------
adc3112.1 dac write 38 0001                  # Enable Internal Reference & reset DACs to gain = 2
adc3112.1 dac write 02 0003                  # Gain DAC-B = 1 and Gain DAC-A = 1
#
adc3112.1 dac write 18 FFFF                  # Write to DAC-A input register and update DAC-A minimum level (max threshold for GPIO, min for channels!)
adc3112.1 dac write 19 7FFF                  # Write to DAC-B input register and update DAC-B; mid-range (0 delay)
#
$echo *****************************************************************
$echo      XRA1404 01 & 23 & TRIG initialized
$echo *****************************************************************
# <EOF>
